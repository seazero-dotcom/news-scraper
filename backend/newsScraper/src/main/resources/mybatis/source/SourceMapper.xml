<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.doubledowninteractive.news.source.repository.SourceMapper">
    <resultMap id="SourceMap" type="com.doubledowninteractive.news.source.domain.Source">
        <id property="id" column="id"/>
        <result property="code" column="code"/>
        <result property="name" column="name"/>
        <result property="baseUrl" column="base_url"/>
        <result property="enabled" column="enabled"/>
        <result property="createdAt" column="created_at"/>
        <result property="collector" column="collector"/>
        <result property="params" column="params"/>
    </resultMap>

    <select id="findAll" parameterType="java.lang.Long" resultMap="SourceMap">
        SELECT * FROM sources WHERE user_id = #{userId} ORDER BY id DESC
    </select>

    <select id="findById" parameterType="java.lang.Long" resultMap="SourceMap">
        SELECT * FROM sources WHERE id = #{id} AND user_id = #{userId}
    </select>

    <select id="findByCode" parameterType="string" resultMap="SourceMap">
        SELECT * FROM sources WHERE code = #{code} AND enabled = 1
    </select>

    <insert id="insert" parameterType="com.doubledowninteractive.news.source.dto.SourceDto">
        INSERT INTO sources(user_id, code, name, base_url, enabled, collector, params)
        VALUES(#{userId}, #{code}, #{name}, #{baseUrl}, #{enabled}, #{collector}, #{params})
    </insert>


    <update id="updateEnabled" parameterType="com.doubledowninteractive.news.source.dto.SourceDto">
        UPDATE sources SET enabled = #{enabled} WHERE id = #{id} AND user_id = #{userId}
    </update>

    <update id="update" parameterType="com.doubledowninteractive.news.source.dto.SourceDto">
        UPDATE sources
        <set>
            <if test="name != null"> name = #{name}, </if>
            <if test="baseUrl != null"> base_url = #{baseUrl}, </if>
            <if test="collector != null"> collector = #{collector}, </if>
            <if test="params != null"> params = #{params}, </if>
        </set>
        WHERE id = #{id} AND user_id = #{userId}
    </update>

    <delete id="deleteById" parameterType="com.doubledowninteractive.news.source.dto.SourceDto">
        DELETE FROM sources WHERE id = #{id} AND user_id = #{userId}
    </delete>

    <select id="findAllEnabled" parameterType="java.lang.Long" resultMap="SourceMap">
        SELECT * FROM sources WHERE enabled = 1 AND user_id = #{userId} ORDER BY id ASC
    </select>

</mapper>
